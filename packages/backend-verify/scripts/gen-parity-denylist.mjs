import * as path from "node:path";
import { fileURLToPath } from "node:url";

import { computeContractKeys } from "./parity-contract-keys.mjs";

const scriptDir = path.dirname(fileURLToPath(import.meta.url));

const contractIndexPath = path.resolve(scriptDir, "../../backend-contract/src/index.ts");
const contractDomainsDir = path.resolve(scriptDir, "../../backend-contract/src/domains");

const contractKeys = computeContractKeys({ indexPath: contractIndexPath, domainsDir: contractDomainsDir });

const format = process.argv.includes("--ts") ? "ts" : process.argv.includes("--lines") ? "lines" : "json";

if (format === "lines") {
  for (const k of contractKeys) console.log(k);
} else if (format === "ts") {
  console.log(
    [
      "// Generated by: node ./packages/backend-verify/scripts/gen-parity-denylist.mjs --ts",
      "// Source: SpiceBackend contract in packages/backend-contract/src/index.ts",
      "",
      `export const PARITY_SCENARIO_DENYLIST = ${JSON.stringify(contractKeys, null, 2)} as const;`,
      "",
    ].join("\n"),
  );
} else {
  console.log(JSON.stringify(contractKeys, null, 2));
}
